<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FoodHub - Order Food Online</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"> 
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --black: #000000;
            --dark-gray: #1A1A1A;
            --yellow: #FFD700;
            --gold: #FFC107;
            --light-yellow: #FFF9C4;
            --gray: #6C757D;
            --success: #28A745;
        }
        
        body { 
            padding-top: 80px; 
            background: var(--dark-gray);
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        /* Navigation */
        .navbar {
            background: var(--black) !important;
            box-shadow: 0 2px 10px rgba(255, 215, 0, 0.1);
            padding: 1rem 0;
            border-bottom: 2px solid var(--yellow);
        }

        .navbar-brand { 
            font-weight: 800; 
            font-size: 1.8rem;
            color: var(--yellow) !important;
        }

        .nav-link {
            color: #cccccc !important; 
            font-weight: 500;
            margin: 0 10px;
            transition: all 0.3s ease;
            position: relative;
            padding: 8px 16px !important;
            border-radius: 8px;
        }

        .nav-link:hover {
            color: var(--yellow) !important;
            background: rgba(255, 215, 0, 0.1);
            transform: translateY(-2px);
        }

        .nav-link.active {
            color: var(--yellow) !important;
            background: rgba(255, 215, 0, 0.15);
            font-weight: 600;
        }

        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: -12px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 6px;
            background: var(--yellow);
            border-radius: 50%;
        }

        .cart-badge { 
            position: absolute; 
            top: -8px; 
            right: -8px; 
            background: var(--yellow);
            color: var(--black);
            border-radius: 50%;
            padding: 4px 8px;
            font-size: 11px;
            font-weight: bold;
            min-width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .nav-link:hover .cart-badge {
            transform: scale(1.1);
        }       
        .cart-badge { 
            position: absolute; 
            top: -8px; 
            right: -8px; 
            background: var(--yellow);
            color: var(--black);
            border-radius: 50%;
            padding: 4px 8px;
            font-size: 11px;
            font-weight: bold;
            min-width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* E-commerce Product Cards */
        .product-card {
            background: var(--dark-gray);
            border-radius: 12px;
            border: 2px solid #333;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.1);
            transition: all 0.3s ease;
            overflow: hidden;
            margin-bottom: 25px;
            height: 100%;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            border-color: var(--yellow);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.2);
        }
        
        .product-image {
            height: 180px;
            width: 100%;
            object-fit: cover;
            border-radius: 12px 12px 0 0;
        }
        
        .product-content {
            padding: 20px;
        }
        
        .product-category {
            background: #333;
            color: var(--yellow);
            font-size: 0.75rem;
            font-weight: 600;
            padding: 4px 12px;
            border-radius: 20px;
            display: inline-block;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .product-title {
            color: var(--yellow);
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 8px;
            line-height: 1.3;
        }
        
        .product-description {
            color: #ccc;
            font-size: 0.85rem;
            line-height: 1.4;
            margin-bottom: 15px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .product-price {
            color: var(--yellow);
            font-size: 1.4rem;
            font-weight: 800;
            margin-bottom: 15px;
        }
        
        .product-rating {
            color: var(--yellow);
            font-size: 0.9rem;
            margin-bottom: 12px;
        }
        
        .product-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-add-cart {
            background: var(--yellow);
            border: none;
            color: var(--black);
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            flex: 1;
        }
        
        .btn-add-cart:hover {
            background: var(--gold);
            transform: translateY(-2px);
        }
        
        .btn-view-details {
            background: transparent;
            border: 2px solid var(--yellow);
            color: var(--yellow);
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .btn-view-details:hover {
            background: var(--yellow);
            color: var(--black);
        }
        
        /* Category Filter */
        .category-filter {
            background: var(--dark-gray);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(255, 215, 0, 0.1);
            border: 2px solid #333;
        }
        
        .category-btn {
            background: #333;
            border: 2px solid #555;
            color: #ccc;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 600;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        .category-btn:hover,
        .category-btn.active {
            background: var(--yellow);
            color: var(--black);
            border-color: var(--yellow);
        }
        
        /* Search Bar */
        .search-container {
            background: var(--dark-gray);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(255, 215, 0, 0.1);
            border: 2px solid #333;
        }
        
        .search-input {
            background: #2A2A2A;
            border: 2px solid #444;
            color: white;
            border-radius: 25px;
            padding: 12px 20px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            background: #2A2A2A;
            border-color: var(--yellow);
            color: white;
            box-shadow: 0 0 0 0.2rem rgba(255, 215, 0, 0.25);
        }
        
        .search-input::placeholder {
            color: #888;
        }
        
        /* Hero Section */
        .hero-section {
            background: linear-gradient(135deg, var(--black) 0%, #333 100%);
            color: var(--yellow);
            padding: 60px 0;
            margin-bottom: 40px;
            border-radius: 0 0 20px 20px;
            border-bottom: 3px solid var(--yellow);
        }
        
        /* Form Controls */
        .form-control {
            background: #2A2A2A;
            border: 2px solid #444;
            color: white;
        }
        
        .form-control:focus {
            background: #2A2A2A;
            border-color: var(--yellow);
            color: white;
            box-shadow: 0 0 0 0.2rem rgba(255, 215, 0, 0.25);
        }
        
        .form-label {
            color: var(--yellow);
            font-weight: 600;
        }
        
        /* Cards */
        .card {
            background: var(--dark-gray);
            border: 2px solid #333;
            color: white;
        }
        
        .card-header {
            background: #333 !important;
            border-bottom: 1px solid #444;
            color: var(--yellow);
        }
        
        /* Buttons */
        .btn-primary {
            background: var(--yellow);
            border-color: var(--yellow);
            color: var(--black);
            font-weight: 600;
        }
        
        .btn-primary:hover {
            background: var(--gold);
            border-color: var(--gold);
            color: var(--black);
        }
        
        .btn-success {
            background: var(--yellow);
            border-color: var(--yellow);
            color: var(--black);
            font-weight: 600;
        }
        
        /* Text Colors */
        .text-primary {
            color: var(--yellow) !important;
        }
        
        .text-muted {
            color: #888 !important;
        }
        
        /* Input Group */
        .input-group-text {
            background: #333;
            border: 2px solid #444;
            color: var(--yellow);
        }
        
        /* Page Sections */
        #loginPage, #mainApp { display: none; }
        
        /* Toast Notifications */
        .toast {
            background: var(--yellow);
            color: var(--black);
            border-radius: 10px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .product-actions {
                flex-direction: column;
            }
            
            .btn-add-cart,
            .btn-view-details {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-utensils me-2"></i>KainMami
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" onclick="showPage('home')">
                            <i class="fas fa-home me-1"></i> Home
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link position-relative" href="#" onclick="showPage('cart')">
                            <i class="fas fa-shopping-cart me-1"></i> Cart
                            <span class="cart-badge" id="cartBadge" style="display:none;">0</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showPage('orders')">
                            <i class="fas fa-receipt me-1"></i> Orders
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showPage('account')">
                            <i class="fas fa-user me-1"></i> Account
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="logout()">
                            <i class="fas fa-sign-out-alt me-1"></i> Logout
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Login/Register Page -->
    <div id="loginPage" class="container">
        <div class="row justify-content-center" style="margin-top: 100px;">
            <div class="col-md-5">
                <div class="card shadow-lg border-secondary">
                    <div class="card-body p-5">
                        <div class="text-center mb-4">
                            <i class="fas fa-utensils fa-3x text-warning mb-3"></i>
                            <h3 class="fw-bold text-warning">Welcome to KainMami</h3>
                            <p class="text-muted">Your favorite meals, delivered fast!</p>
                        </div>
                        
                        <!-- Login Form -->
                        <div id="loginForm">
                            <h5 class="mb-4 text-center text-warning">Sign In</h5>
                            <form id="loginFormSubmit">
                                <div class="mb-3">
                                    <label class="form-label fw-semibold">Username</label>
                                    <input type="text" class="form-control form-control-lg" id="loginUsername" required placeholder="Enter your username">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label fw-semibold">Password</label>
                                    <input type="password" class="form-control form-control-lg" id="loginPassword" required placeholder="Enter your password">
                                </div>
                                <button type="submit" class="btn btn-primary w-100 btn-lg mb-3">Sign In</button>
                            </form>
                            <div class="text-center">
                                <small class="text-muted">Don't have an account? 
                                    <a href="#" onclick="toggleAuthForm()" class="text-warning fw-semibold">Register here</a>
                                </small>
                            </div>
                        </div>

                        <!-- Register Form -->
                        <div id="registerForm" style="display:none;">
                            <h5 class="mb-4 text-center text-warning">Create Account</h5>
                            <form id="registerFormSubmit">
                                <div class="mb-3">
                                    <label class="form-label fw-semibold">Username</label>
                                    <input type="text" class="form-control form-control-lg" id="regUsername" required placeholder="Choose a username">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label fw-semibold">Password</label>
                                    <input type="password" class="form-control form-control-lg" id="regPassword" required placeholder="Create a password">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label fw-semibold">Full Name</label>
                                    <input type="text" class="form-control form-control-lg" id="regName" required placeholder="Enter your full name">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label fw-semibold">Phone Number</label>
                                    <input type="tel" class="form-control form-control-lg" id="regPhone" required placeholder="Enter your phone number">
                                </div>
                                <button type="submit" class="btn btn-success w-100 btn-lg mb-3">Create Account</button>
                            </form>
                            <div class="text-center">
                                <small class="text-muted">Already have an account? 
                                    <a href="#" onclick="toggleAuthForm()" class="text-warning fw-semibold">Sign in here</a>
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="container">
        <!-- Home Page -->
        <div id="homePage" class="page">
            <!-- Hero Section -->
            <div class="hero-section text-center">
                <div class="container">
                    <h1 class="display-5 fw-bold mb-3">Craving Something Delicious?</h1>
                    <p class="lead mb-4">Discover amazing food from local restaurants near you</p>
                    <div class="row justify-content-center">
                        <div class="col-md-8">
                            <div class="search-container">
                                <div class="input-group input-group-lg">
                                    <span class="input-group-text bg-dark border-0">
                                        <i class="fas fa-search text-warning"></i>
                                    </span>
                                    <input type="text" class="form-control search-input border-0" id="searchInput" placeholder="Search for food, restaurants, or cuisines...">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Category Filter -->
            <div class="category-filter text-center">
                <h5 class="fw-bold mb-4 text-warning">Browse Categories</h5>
                <div>
                    <button class="btn category-btn active" onclick="filterCategory('', this)">All Items</button>
                    <button class="btn category-btn" onclick="filterCategory('Breakfast', this)">üç≥ Breakfast</button>
                    <button class="btn category-btn" onclick="filterCategory('Lunch', this)">üçî Lunch</button>
                    <button class="btn category-btn" onclick="filterCategory('Snacks', this)">üçü Snacks</button>
                    <button class="btn category-btn" onclick="filterCategory('Dinner', this)">üçù Dinner</button>
                    <button class="btn category-btn" onclick="filterCategory('Dessert', this)">üç∞ Dessert</button>
                </div>
            </div>

            <!-- Product Grid -->
            <div class="row">
                <div class="col-12">
                    <h4 class="fw-bold mb-4 text-warning">Popular Items</h4>
                </div>
                <div id="foodsList" class="row"></div>
            </div>
        </div>

        <!-- Cart Page -->
        <div id="cartPage" class="page" style="display:none;">
            <h2 class="fw-bold mb-4 text-warning"><i class="fas fa-shopping-cart me-2"></i>Shopping Cart</h2>
            <div class="row">
                <div class="col-md-8">
                    <div id="cartItems"></div>
                </div>
                <div class="col-md-4">
                    <div class="card shadow-sm border-secondary sticky-top" style="top: 100px;">
                        <div class="card-body">
                            <h5 class="fw-bold text-warning">Order Summary</h5>
                            <hr style="border-color: #444;">
                            <div class="d-flex justify-content-between mb-2">
                                <span>Subtotal:</span>
                                <span id="cartSubtotal" class="fw-bold text-warning">‚Ç±0.00</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                                <span>Delivery Fee:</span>
                                <span>‚Ç±49.00</span>
                            </div>
                            <hr style="border-color: #444;">
                            <div class="d-flex justify-content-between mb-3">
                                <strong>Total:</strong>
                                <strong id="cartTotal" class="text-warning">‚Ç±49.00</strong>
                            </div>
                            <button class="btn btn-primary w-100 btn-lg" onclick="checkout()">
                                <i class="fas fa-check me-2"></i> Checkout Now
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Orders Page -->
        <div id="ordersPage" class="page" style="display:none;">
            <h2 class="fw-bold mb-4 text-warning"><i class="fas fa-receipt me-2"></i>My Orders</h2>
            <div id="ordersList"></div>
        </div>

        <!-- Account Page -->
        <div id="accountPage" class="page" style="display:none;">
            <h2 class="fw-bold mb-4 text-warning"><i class="fas fa-user-circle me-2"></i>Account Settings</h2>
            <div class="row">
                <div class="col-md-6 mx-auto">
                    <div class="card shadow-sm border-secondary">
                        <div class="card-body p-4">
                            <form id="accountForm">
                                <div class="mb-3">
                                    <label class="form-label fw-semibold">Username</label>
                                    <input type="text" class="form-control" id="accountUsername" readonly>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label fw-semibold">Full Name</label>
                                    <input type="text" class="form-control" id="accountName" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label fw-semibold">Phone Number</label>
                                    <input type="tel" class="form-control" id="accountPhone" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label fw-semibold">New Password (leave blank to keep current)</label>
                                    <input type="password" class="form-control" id="accountPassword" placeholder="Enter new password">
                                </div>
                                <button type="submit" class="btn btn-primary w-100 btn-lg">
                                    <i class="fas fa-save me-2"></i> Update Account
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_BASE = 'http://localhost:8000/api';
        let token = null;
        let currentCategory = '';
        let cart = [];
        let currentUser = null;

        // ============ Cart Management ============
        function addToCart(food) {
            const existing = cart.find(item => item.id === food.id);
            if (existing) {
                existing.quantity++;
            } else {
                cart.push({
                    id: food.id,
                    name: food.name,
                    price: food.price,
                    quantity: 1,
                    image_url: food.image_url
                });
            }
            updateCartBadge();
            showToast('Added to cart!', 'success');
        }

        function removeFromCart(foodId) {
            cart = cart.filter(item => item.id !== foodId);
            updateCartBadge();
            displayCart();
        }

        function updateQuantity(foodId, delta) {
            const item = cart.find(item => item.id === foodId);
            if (item) {
                item.quantity += delta;
                if (item.quantity <= 0) {
                    removeFromCart(foodId);
                } else {
                    displayCart();
                    updateCartBadge();
                }
            }
        }

        function getCartTotal() {
            return cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        }

        function updateCartBadge() {
            const badge = document.getElementById('cartBadge');
            const count = cart.reduce((sum, item) => sum + item.quantity, 0);
            if (count > 0) {
                badge.textContent = count;
                badge.style.display = 'flex';
            } else {
                badge.style.display = 'none';
            }
        }

        // ============ Authentication ============
        window.addEventListener('DOMContentLoaded', () => {
            token = localStorage.getItem('clientToken');
            if (token) {
                currentUser = JSON.parse(localStorage.getItem('clientUser'));
                document.getElementById('mainApp').style.display = 'block';
                loadHome();
            } else {
                document.getElementById('loginPage').style.display = 'block';
            }
        });

        function toggleAuthForm() {
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            if (loginForm.style.display === 'none') {
                loginForm.style.display = 'block';
                registerForm.style.display = 'none';
            } else {
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
            }
        }
document.getElementById('loginFormSubmit').addEventListener('submit', async (e) => {
    e.preventDefault();
    const username = document.getElementById('loginUsername').value;
    const password = document.getElementById('loginPassword').value;

    try {
        const res = await fetch(`${API_BASE}/login`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password })
        });

        const data = await res.json();
        if (res.ok) {
            // ‚úÖ CHECK USER ROLE
            if (data.user.role === 'admin') {
                // Admin user - redirect to admin interface
                window.location.href = '/admin';
            } else {
                // Regular user - proceed with client interface
                token = data.token;
                currentUser = data.user;
                localStorage.setItem('clientToken', token);
                localStorage.setItem('clientUser', JSON.stringify(currentUser));
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                loadHome();
                showToast('Login successful!', 'success');
            }
        } else {
            showToast('Login failed: ' + data.message, 'error');
        }
    } catch (err) {
        showToast('Login failed: ' + err.message, 'error');
    }
});
               
        document.getElementById('registerFormSubmit').addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = {
                username: document.getElementById('regUsername').value,
                password: document.getElementById('regPassword').value,
                name: document.getElementById('regName').value,
                phone: document.getElementById('regPhone').value
            };

            console.log("üîç DEBUG: Sending registration data:", data);

            try {
                const res = await fetch(`${API_BASE}/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const responseData = await res.json();
                console.log("üîç DEBUG: Server response:", responseData);

                if (res.ok) {
                    showToast('Registration successful! Please login.', 'success');
                    toggleAuthForm();
                } else {
                    showToast(`Registration failed: ${responseData.message}`, 'error');
                }
            } catch (err) {
                console.error("üîç DEBUG: Registration error:", err);
                showToast('Registration failed: ' + err.message, 'error');
            }
        });

        function logout() {
            localStorage.removeItem('clientToken');
            localStorage.removeItem('clientUser');
            token = null;
            currentUser = null;
            cart = [];
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('loginPage').style.display = 'block';
            showToast('Logged out successfully', 'success');
        }

        // ============ Page Navigation ============
        function showPage(page) {
            document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
            document.getElementById(page + 'Page').style.display = 'block';

            if (page === 'home') loadHome();
            else if (page === 'cart') displayCart();
            else if (page === 'orders') loadOrders();
            else if (page === 'account') loadAccount();
        }

        // ============ Load Home ============
        async function loadHome() {
            const search = document.getElementById('searchInput')?.value || '';
            const url = `${API_BASE}/foods?category=${currentCategory}&search=${search}`;
            const res = await fetch(url);
            const foods = await res.json();

            const html = foods.map(f => `
                <div class="col-md-6 col-lg-4 col-xl-3">
                    <div class="product-card">
                        <img src="${f.image_url}" class="product-image" alt="${f.name}">
                        <div class="product-content">
                            <div class="product-category">${f.category}</div>
                            <h3 class="product-title">${f.name}</h3>
                            <p class="product-description">${f.description}</p>
                            <div class="product-price">‚Ç±${f.price.toFixed(2)}</div>
                            <div class="product-rating">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star-half-alt"></i>
                                <span class="text-muted ms-1">(4.5)</span>
                            </div>
                            <div class="product-actions">
                                <button class="btn-add-cart" onclick="addToCart(${JSON.stringify(f).replace(/"/g, '&quot;')})">
                                    <i class="fas fa-cart-plus me-1"></i> Add to Cart
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');

            document.getElementById('foodsList').innerHTML = html || `
                <div class="col-12 text-center py-5">
                    <i class="fas fa-utensils fa-4x text-muted mb-3"></i>
                    <h4 class="text-muted">No food items found</h4>
                    <p class="text-muted">Try adjusting your search or filter</p>
                </div>
            `;
        }

        document.getElementById('searchInput')?.addEventListener('input', loadHome);

        function filterCategory(category, element) {
            currentCategory = category;
            document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
            element.classList.add('active');
            loadHome();
        }

        // ============ Display Cart ============
        function displayCart() {
            if (cart.length === 0) {
                document.getElementById('cartItems').innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-shopping-cart fa-4x text-muted mb-3"></i>
                        <h4 class="text-muted">Your cart is empty</h4>
                        <p class="text-muted mb-4">Add some delicious items to get started!</p>
                        <button class="btn btn-primary btn-lg" onclick="showPage('home')">
                            <i class="fas fa-utensils me-2"></i> Browse Menu
                        </button>
                    </div>
                `;
                document.getElementById('cartSubtotal').textContent = '‚Ç±0.00';
                document.getElementById('cartTotal').textContent = '‚Ç±49.00';
                return;
            }

            const html = cart.map(item => `
                <div class="card product-card mb-3">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-2">
                                <img src="${item.image_url}" class="img-fluid rounded" alt="${item.name}" style="height: 80px; object-fit: cover;">
                            </div>
                            <div class="col-md-4">
                                <h5 class="fw-bold">${item.name}</h5>
                                <p class="text-muted mb-0">‚Ç±${item.price.toFixed(2)} each</p>
                            </div>
                            <div class="col-md-3">
                                <div class="btn-group" role="group">
                                    <button class="btn btn-outline-secondary" onclick="updateQuantity(${item.id}, -1)">-</button>
                                    <button class="btn btn-outline-secondary" disabled>${item.quantity}</button>
                                    <button class="btn btn-outline-secondary" onclick="updateQuantity(${item.id}, 1)">+</button>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <h5 class="text-warning fw-bold">‚Ç±${(item.price * item.quantity).toFixed(2)}</h5>
                            </div>
                            <div class="col-md-1">
                                <button class="btn btn-danger btn-sm" onclick="removeFromCart(${item.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');

            document.getElementById('cartItems').innerHTML = html;
            const subtotal = getCartTotal();
            document.getElementById('cartSubtotal').textContent = '‚Ç±' + subtotal.toFixed(2);
            document.getElementById('cartTotal').textContent = '‚Ç±' + (subtotal + 49).toFixed(2);
        }

        // ============ Checkout ============
        async function checkout() {
            if (cart.length === 0) {
                showToast('Cart is empty', 'error');
                return;
            }

            try {
                const res = await fetch(`${API_BASE}/orders`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        items: cart,
                        total_price: getCartTotal()
                    })
                });

                if (res.ok) {
                    cart = [];
                    updateCartBadge();
                    showToast('Order placed successfully!', 'success');
                    showPage('orders');
                } else {
                    showToast('Checkout failed', 'error');
                }
            } catch (err) {
                showToast('Checkout failed', 'error');
            }
        }

        // ============ Load Orders ============
        async function loadOrders() {
            try {
                const res = await fetch(`${API_BASE}/orders`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const orders = await res.json();

                if (orders.length === 0) {
                    document.getElementById('ordersList').innerHTML = `
                        <div class="text-center py-5">
                            <i class="fas fa-receipt fa-4x text-muted mb-3"></i>
                            <h4 class="text-muted">No orders yet</h4>
                            <p class="text-muted">Your order history will appear here</p>
                        </div>
                    `;
                    return;
                }

                const html = orders.map(o => `
                    <div class="card product-card mb-3">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div>
                                    <h5 class="fw-bold">Order #${o.id}</h5>
                                    <small class="text-muted">${o.created_at}</small>
                                </div>
                                <span class="badge ${o.status === 'delivered' ? 'bg-success' : o.status === 'ready' ? 'bg-info' : 'bg-warning'}">
                                    ${o.status.toUpperCase().replace('_', ' ')}
                                </span>
                            </div>
                            <p class="mb-2"><strong>Items:</strong> ${o.items.map(i => `${i.name} (x${i.quantity})`).join(', ')}</p>
                            <h5 class="text-warning fw-bold">Total: ‚Ç±${o.total_price.toFixed(2)}</h5>
                        </div>
                    </div>
                `).join('');

                document.getElementById('ordersList').innerHTML = html;
            } catch (err) {
                showToast('Failed to load orders', 'error');
            }
        }

        // ============ Load Account ============
        async function loadAccount() {
            try {
                const res = await fetch(`${API_BASE}/account`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const user = await res.json();

                document.getElementById('accountUsername').value = user.username;
                document.getElementById('accountName').value = user.name;
                document.getElementById('accountPhone').value = user.phone;
            } catch (err) {
                showToast('Failed to load account', 'error');
            }
        }

        document.getElementById('accountForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const data = {
                name: document.getElementById('accountName').value,
                phone: document.getElementById('accountPhone').value,
                password: document.getElementById('accountPassword').value
            };

            try {
                const res = await fetch(`${API_BASE}/account`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                if (res.ok) {
                    showToast('Account updated successfully', 'success');
                    document.getElementById('accountPassword').value = '';
                } else {
                    showToast('Update failed', 'error');
                }
            } catch (err) {
                showToast('Update failed', 'error');
            }
        });

        // ============ Toast Notifications ============
        function showToast(message, type) {
            const toastHtml = `
                <div class="toast align-items-center text-white bg-${type === 'success' ? 'warning' : 'danger'} border-0 position-fixed bottom-0 end-0 m-3" role="alert">
                    <div class="d-flex">
                        <div class="toast-body" style="color: black;">${message}</div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', toastHtml);
            const toastEl = document.querySelector('.toast:last-child');
            const toast = new bootstrap.Toast(toastEl);
            toast.show();
            setTimeout(() => toastEl.remove(), 3000);
        }
    </script>
</body>
</html>
